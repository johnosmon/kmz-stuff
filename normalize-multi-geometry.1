.TH NORMALIZE-MULTI-GEOMETRY 1 "February 2026" "normalize-multi-geometry.py" "User Commands"
.SH NAME
normalize-multi-geometry \- normalize Google Earth KML/KMZ MultiGeometry polylines for QGIS
.SH SYNOPSIS
.B normalize-multi-geometry.py
.RB [ \-i " " FILE ]
.RB [ \-o " " FILE ]
.RB [ \-z ]
.RB [ \-v ]
.RB [ \-h ]
.SH DESCRIPTION
.B normalize-multi-geometry.py
reads Google Earth KML or KMZ and normalizes LineString geometry for improved interoperability
with QGIS and GDAL. In particular, it targets files created by Google Earthâ€™s
\[lq]Combine into MultiGeometry\[rq], which often appears in QGIS as a single feature or as
a geometry collection that breaks QGIS Processing tools.

The tool performs two steps:
.IP 1. 4
Explode MultiGeometry LineStrings:
Any Placemark containing a MultiGeometry with more than one LineString descendant is replaced by
multiple Placemarks, each containing exactly one LineString. Common metadata (name/style/visibility/
description/ExtendedData) is preserved.
.IP 2. 4
Clean LineStrings:
For all LineStrings, the tool drops non-finite coordinates (NaN/Inf), removes consecutive duplicate
XY vertices, and removes degenerate LineStrings with fewer than two vertices after cleaning.

Input is autodetected as KML or KMZ. Output defaults to KML unless
.BR \-z / \-\-kmz-out
is specified.
.SH OPTIONS
.TP
.BR \-i ", " \-\-input-file " " FILE
Read input from
.IR FILE .
Input may be KML or KMZ. If omitted, input is read from STDIN.
.TP
.BR \-o ", " \-\-output-file " " FILE
Write output to
.IR FILE .
If omitted, output is written to STDOUT.
.TP
.BR \-z ", " \-\-kmz-out
Write KMZ output instead of KML.
The KMZ output is written with a single canonical
.B doc.kml
plus any non-KML assets preserved from the input KMZ (icons, overlays, etc.).
If the input is KML, KMZ output will contain only
.B doc.kml
(no additional assets).
.TP
.BR \-v ", " \-\-verbose
Print a processing summary to STDERR (counts before/after explode and cleaning, selected KML member,
and output format). By default, the program is silent on success.
.TP
.BR \-h ", " \-\-help
Show usage help and exit.
.SH INPUT
Input is either:
.IP \[bu] 2
KML (XML), or
.IP \[bu] 2
KMZ (ZIP) containing one or more .kml members.
.PP
When reading KMZ, the tool uses
.B doc.kml
if present; otherwise it uses the largest .kml member.
.SH OUTPUT
By default, output is KML (UTF-8 XML) written to STDOUT or to the file specified by
.BR \-o .
With
.BR \-z ,
output is KMZ.
.SH EXAMPLES
Normalize a KMZ and emit KML:
.PP
.nf
normalize-multi-geometry.py -i NM_Fiber.kmz -o NM_Fiber.normalized.kml
.fi
.PP
Normalize KML from STDIN to STDOUT:
.PP
.nf
cat in.kml | normalize-multi-geometry.py > out.kml
.fi
.PP
Normalize and emit KMZ:
.PP
.nf
normalize-multi-geometry.py -i in.kmz -o out.kmz -z
.fi
.PP
Verbose summary:
.PP
.nf
normalize-multi-geometry.py -i in.kmz -o out.kml -v
.fi
.SH EXIT STATUS
.TP
.B 0
Success.
.TP
.B 2
Usage error or invalid input (empty input, malformed XML, KMZ without KML members).
.TP
.B 1
Unexpected runtime error.
.SH LIMITATIONS
.IP \[bu] 2
This tool normalizes
.B LineString
geometry. Other geometry types are not explicitly repaired.
.IP \[bu] 2
KML using Google extensions such as
.B gx:Track
is not converted to LineString by this tool.
.IP \[bu] 2
If QGIS Processing still reports invalid features, the issue may involve geometry collections created
during import or non-LineString layers; additional type-specific normalization may be required.
.SH SEE ALSO
.BR qgis (1),
.BR ogr2ogr (1)
.SH AUTHOR
Generated for normalize-multi-geometry.py.

